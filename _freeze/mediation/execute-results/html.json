{
  "hash": "3aee0ecb914866bd535e14156594ce1e",
  "result": {
    "markdown": "# Mediation analysis\n\n<iframe src=\"https://teesside.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=dd3163e4-ab0e-449d-b252-adaa008f4394&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&captions=false&interactivity=all\" height=\"405\" width=\"100%\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n\n## Overview\n\n\n- What are mediation and moderation?\n- Mediation analysis example\n- Packages needed\n- Baron and Kenny approach in R\n- Mediation package approach in R\n\n## What is mediation?\n\nWhere the relationship between a predictor (X) and an outcome (Y) is mediated by another variable (M). \n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n![A mediated relationship](images/mediation_model1.png)\n\nIn the above model, we theorise that socio-economic status predicts education level, which predicts future prospects.\n\n\n## What is moderation?\n\n\nThere is a direct relationship between X and Y but it is affected by a moderator (M)\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n![A moderated relationship](images/moderation_model2.png)\n\nIn the above model, we theorise that socio-economic status predicts future prospects but the strength of the relationship is changed by education level\n\n\n\n## Why different models?\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n![A mediated relationship](images/mediation_model1.png)\n\nThis might be more appropriate if higher education costs money\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n![A moderated relationship](images/moderation_model2.png)\n\nThis might be more appropriate if access to higher education is free \n\n\n## Mediation analysis\n\n\n\n### What is a mediation design?\n\n\nWhether a mediation analysis is appropriate is determined as much by the design as by statistical criteria.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n![A mediated relationship](images/mediation_model1.png)\n\nWe must consider whether it makes sense to predict this relationship between variables\n\n\n\n### What is mediation analysis?\n\n\n- Based on regression\n\nA summary of the logic of mediation:\n\n- The direct relationship between X and Y should be significant\n- The relationship between X and M should be significant\n- The relationship between M and Y (controlling for X) should be significant\n- When controlling for M, the strength of the relationship between X and Y decreases and is **not** significant\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n![](images/mediation_direct.png)\n![](images/mediation_model1.png)\n\n\n- The direct relationship between X and Y should be significant\n- <span style=\"color: blue;\"> The relationship between X and M should be significant </span>\n- <span style=\"color: green;\"> The relationship between M and Y (controlling for X) should be significant </span>\n- <span style=\"color: red;\"> When controlling for M, the strength of the relationship between X and Y decreases and is **not** significant </span>\n\n> Baron & Kenny (1986) originally used a 4-step regression model to test each of these relationships.\n\n\n### What packages do we need?\n\n\n    library(mediation) #Mediation package\n    \n    library(multilevel) #Sobel Test\n    \n    library(bda) #Another Sobel Test option\n    \n    library(gvlma) #Testing Model Assumptions \n    \n    library(stargazer) #Handy regression tables\n    \n    \n## Mediation analysis (the Baron and Kenny Approach)\n\n\n\n\n### Conducting mediation analysis (the Baron and Kenny Approach)\n\n- Baron & Kenny (1986) originally used a 4-step regression model to test each of these relationships.\n- The sobel test is then used to test the significance of mediation\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n### Step 1: Total Effect\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#1. Total Effect\nfit <- lm(Y ~ X, data=Meddata)\nsummary(fit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Y ~ X, data = Meddata)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-10.917  -3.738  -0.259   2.910  12.540 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)  \n(Intercept) 19.88368   14.26371   1.394   0.1665  \nX            0.16899    0.08116   2.082   0.0399 *\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 5.16 on 98 degrees of freedom\nMultiple R-squared:  0.04237,\tAdjusted R-squared:  0.0326 \nF-statistic: 4.336 on 1 and 98 DF,  p-value: 0.03993\n```\n:::\n:::\n\n\n### Step 2: Path A (X on M)\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#2. Path A (X on M)\nfita <- lm(M ~ X, data=Meddata)\nsummary(fita)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = M ~ X, data = Meddata)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.5367 -3.4175 -0.4375  2.9032 16.4520 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept)  6.04494   13.41692   0.451    0.653    \nX            0.66252    0.07634   8.678 8.87e-14 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.854 on 98 degrees of freedom\nMultiple R-squared:  0.4346,\tAdjusted R-squared:  0.4288 \nF-statistic: 75.31 on 1 and 98 DF,  p-value: 8.872e-14\n```\n:::\n:::\n\n\n### Step 3: Path B (M on Y, controlling for X)\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#3. Path B (M on Y, controlling for X)\nfitb <- lm(Y ~ M + X, data=Meddata)\nsummary(fitb)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = Y ~ M + X, data = Meddata)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-9.3651 -3.3037 -0.6222  3.1068 10.3991 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 17.32177   13.16216   1.316    0.191    \nM            0.42381    0.09899   4.281 4.37e-05 ***\nX           -0.11179    0.09949  -1.124    0.264    \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.756 on 97 degrees of freedom\nMultiple R-squared:  0.1946,\tAdjusted R-squared:  0.1779 \nF-statistic: 11.72 on 2 and 97 DF,  p-value: 2.771e-05\n```\n:::\n:::\n\n\n### Step 4: Reversed Path C (Y on X, controlling for M)\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#4. Reversed Path C (Y on X, controlling for M)\nfitc <- lm(X ~ Y + M, data=Meddata)\nsummary(fitc)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = X ~ Y + M, data = Meddata)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-14.438  -2.573  -0.030   3.010  11.779 \n\nCoefficients:\n            Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 96.11234    9.27663  10.361  < 2e-16 ***\nY           -0.11493    0.10229  -1.124    0.264    \nM            0.69619    0.08356   8.332 5.27e-13 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 4.823 on 97 degrees of freedom\nMultiple R-squared:  0.4418,\tAdjusted R-squared:  0.4303 \nF-statistic: 38.39 on 2 and 97 DF,  p-value: 5.233e-13\n```\n:::\n:::\n\n\n### Viewing output\n\n\n\n    Summary Table\n    stargazer(fit, fita, fitb, fitc, type = \"text\", title = \"Baron and Kenny Method\")\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/baronandkenny.png){fig-align='center' width=100% height=200%}\n:::\n:::\n\n\n### Interpreting Baron and Kenny approach\n\n\nA reminder of the logic of mediation:\n\n- The direct relationship between X and Y should be significant\n- The relationship between X and M should be significant\n- The relationship between M and Y (controlling for X) should be significant\n- When controlling for M, the strength of the relationship between X and Y decreases and is **not** significant\n\n### Running the Sobel test\n\n\n- The Sobel test checks the singificance of indirect effects\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#Sobel Test\nlibrary(multilevel)\nsobel(Meddata$X, Meddata$M, Meddata$Y)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n$`Mod1: Y~X`\n              Estimate Std. Error  t value   Pr(>|t|)\n(Intercept) 19.8836805 14.2637142 1.394004 0.16646905\npred         0.1689931  0.0811601 2.082220 0.03992761\n\n$`Mod2: Y~X+M`\n              Estimate  Std. Error   t value     Pr(>|t|)\n(Intercept) 17.3217682 13.16215851  1.316028 1.912663e-01\npred        -0.1117904  0.09949262 -1.123605 2.639537e-01\nmed          0.4238113  0.09899469  4.281152 4.371472e-05\n\n$`Mod3: M~X`\n             Estimate  Std. Error   t value     Pr(>|t|)\n(Intercept) 6.0449365 13.41692114 0.4505457 6.533122e-01\npred        0.6625203  0.07634187 8.6783345 8.871741e-14\n\n$Indirect.Effect\n[1] 0.2807836\n\n$SE\n[1] 0.07313234\n\n$z.value\n[1] 3.83939\n\n$N\n[1] 100\n```\n:::\n:::\n\n\nHowever, the above code only gives us to information we need to test the significance of the indirect effect, not the significance itself. Thereore, we can use the following, to get the actual significance of the indirect effect:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(bda)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'bda' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: boot\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nbda v15 (Bin Wang, 2021)\n```\n:::\n\n```{.r .cell-code}\nmediation.test(Meddata$M, Meddata$X, Meddata$Y)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|        |     Sobel|   Aroian|   Goodman|\n|:-------|---------:|--------:|---------:|\n|z.value | 3.8393902| 3.819053| 3.8600563|\n|p.value | 0.0001233| 0.000134| 0.0001134|\n\n</div>\n:::\n:::\n\n\n\n## Mediation analysis (the Mediation package)\n\n### Preacher & Hayes (2004) mediation approach\n\n- Mediation package in R uses the  Preacher & Hayes (2004) bootstrapping approach\n- They argue that few people test the significance of the indirect effect\n\n>> \"Baron and Kenny simply state that perfect mediation has occurred if c' becomes nonsignificant after controlling for\nM, so researchers have focused on that requirement.\" (Preacher & Hayes, 2004, p. 719)\n\n- Sobel test has low power (requires larger sample sizes)\n- Sobel test assumes normality (often violated)\n\n\n### What is bootstrapping?\n\n>> \"Bootstrapping is a nonparametric approach to effect-size estimation and hypothesis testing that makes no assumptions about the shape of the distributions of the variables or the sampling distribution of the statistic\" (Preacer & Hayes, 2004, p. 722)\n\n- Bootstrapping takes a large number of samples from our data and runs the analysis on each of these samples\n- The sampling is done randomly with replacement, and each sample in the bootstrap is the same size as our dataset\n\n- Using this method, we can create estimates with that fall within a narrower confidence interval (since we have now run the analysis on 100's of samples)\n- Bootstrapping overcomes concerns about the distribution of our original dataset\n\n\n\n### Mediation example\n\n\nIs the relationship between *No of hours awake* and *wakefulness* mediated by *caffiene consumption*?\n\n>  This example is from  Demos & Salas (2019). *A Language, not a Letter: Learning Statistics in R* (Chapter 14)\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n![](images/mediation_model2.png)\n\n### Step 1: Run the models \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#Mediate package\nlibrary(mediation)\n\nfitM <- lm(M ~ X,     data=Meddata) #IV on M; Hours since waking predicting coffee consumption\nfitY <- lm(Y ~ X + M, data=Meddata) #IV and M on DV; Hours since dawn and coffee predicting wakefulness\n```\n:::\n\n\n### Step 2: Check assumptions\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngvlma(fitM) \n\n# We can see that the data is positively skewed. We might need to transform the data (we will discuss this another time).\n\ngvlma(fitY)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = M ~ X, data = Meddata)\n\nCoefficients:\n(Intercept)            X  \n     6.0449       0.6625  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = fitM) \n\n                   Value p-value                   Decision\nGlobal Stat        8.833 0.06542    Assumptions acceptable.\nSkewness           6.314 0.01198 Assumptions NOT satisfied!\nKurtosis           1.219 0.26949    Assumptions acceptable.\nLink Function      1.076 0.29959    Assumptions acceptable.\nHeteroscedasticity 0.223 0.63674    Assumptions acceptable.\n\nCall:\nlm(formula = Y ~ X + M, data = Meddata)\n\nCoefficients:\n(Intercept)            X            M  \n    17.3218      -0.1118       0.4238  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = fitY) \n\n                     Value p-value                Decision\nGlobal Stat        3.41844  0.4904 Assumptions acceptable.\nSkewness           1.85648  0.1730 Assumptions acceptable.\nKurtosis           0.77788  0.3778 Assumptions acceptable.\nLink Function      0.71512  0.3977 Assumptions acceptable.\nHeteroscedasticity 0.06896  0.7929 Assumptions acceptable.\n```\n:::\n:::\n\n\n\n\n### Step 3.1: Run the mediation analysis on the models\n\n\nThe mediate function gives us:  \n\n- Average Causal Mediation Effects (ACME)\n- Average Direct Effects (ADE) \n- combined indirect and direct effects (Total Effect) \n- the ratio of these estimates (Prop. Mediated). \n\nThe ACME here is the indirect effect of M (total effect - direct effect) and thus this value tells us if our mediation effect is significant.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfitMed <- mediate(fitM, fitY, treat=\"X\", mediator=\"M\")\nsummary(fitMed)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCausal Mediation Analysis \n\nQuasi-Bayesian Confidence Intervals\n\n               Estimate 95% CI Lower 95% CI Upper p-value    \nACME             0.2808       0.1437         0.42  <2e-16 ***\nADE             -0.1133      -0.3116         0.09   0.258    \nTotal Effect     0.1674       0.0208         0.34   0.028 *  \nProp. Mediated   1.6428       0.5631         8.44   0.028 *  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nSample Size Used: 100 \n\n\nSimulations: 1000 \n```\n:::\n:::\n\n\n### Step 3.2: Plot the mediation analysis of the models\n\n\nThe plot below reiterates what was on the previous slide:\n\n- The confidence intervals of Total Effect and ACME are significant\n- The confidence interval of ADE is not significant\n\n **Translation:**\n\n - Total effect is signficant: there is a relationship between X and Y (direct and indirect)\n - ADE is not significant: the relationship between X and Y is not direct\n - ACME is significant: the relationship between X and Y is mediated by M\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot(fitMed)\n```\n\n::: {.cell-output-display}\n![](mediation_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n### Step 4: Bootstrap the mediation model\n\n\nThe plot below changes our interpretation slightly:\n\n- The confidence interval ACME is significant\n- The confidence interval of Total Effect and ADE are not significant\n\n **Translation:**\n\n- Total effect is not signficant: the relationship between X and Y is not significant when we combine direct and indirect effects\n\n- ADE is not significant: the relationship between X and Y is not direct\n\n- ACME is significant: the relationship between X and Y is mediated by M\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfitMedBoot <- mediate(fitM, fitY, boot=TRUE, sims=999, treat=\"X\", mediator=\"M\")\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRunning nonparametric bootstrap\n```\n:::\n\n```{.r .cell-code}\nsummary(fitMedBoot)\nplot(fitMedBoot) ##\n```\n\n::: {.cell-output-display}\n![](mediation_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCausal Mediation Analysis \n\nNonparametric Bootstrap Confidence Intervals with the Percentile Method\n\n               Estimate 95% CI Lower 95% CI Upper p-value    \nACME             0.2808       0.1409         0.42  <2e-16 ***\nADE             -0.1118      -0.3080         0.12    0.31    \nTotal Effect     0.1690      -0.0123         0.34    0.07 .  \nProp. Mediated   1.6615      -3.7235        11.33    0.07 .  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nSample Size Used: 100 \n\n\nSimulations: 999 \n```\n:::\n:::\n\n\n\n## References\n\nDemos & Salas (2019). *A Language, not a Letter: Learning Statistics in R* (Chapter 14). https://ademos.people.uic.edu/ Accessed Jan 2020.\n\nPreacher, K. J., & Hayes, A. F. (2004). SPSS and SAS procedures for estimating indirect effects in simple mediation models. Behavior research methods, instruments, & computers, 36(4), 717-731.\n\n\n",
    "supporting": [
      "mediation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}