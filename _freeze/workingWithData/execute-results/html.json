{
  "hash": "cd1a76e9f2c5b510136c384df5ccb183",
  "result": {
    "markdown": "\n\n\n\n# Working with data in R\n\n<iframe src=\"https://teesside.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=4d1a880f-b435-465a-95a3-adaa00908325&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&captions=false&interactivity=all\" height=\"405\" width=\"100%\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n\n## By the end of this section, you will be able to:\n- Import data into R from excel, SPSS and csv files\n- Save data to objects\n- Identify different data structures and variable types\n- Convert variables from one type to another\n- Order, filter and group data\n- Summarise data\n- Create new variables from data\n\n\n## In this section, we will use the Tidyverse set of packages\n\n-\tA ‘toolkit’ of packages that are very useful for organsing and manipulating data\n- We will use the haven package to import SPSS files\n- We will use the dplyr to organise data\n- Also includes the ggplot2 and tidyR packages which we will use later\n\nTo install: \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ninstall.packages(“tidyverse”)\n```\n:::\n\n\n   \n\n(See the previous section on installing packages)\n\n## Import data into R from excel, SPSS and csv files\n\nWe can import data from a range of sources using the **Import Dataset** button in the **Environment** tab:\n\n![Importing data](images/importData.png)\n\nIt is also possible to import data using code, for example:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n # importing a .csv file\n    \n    library(readr)\n    studentData <- read_csv(\"Datasets/studentData.csv\")\n\n    #importing an SPSS file\n    \n    library(haven)\n    mySPSSData <- read_sav(\"datasets/salesData.sav\")\n```\n:::\n\n\n   \n\nOnce the data are imported, it will be visible in the environment: \n\n![Imported data in the environment](images/environment.png)\n\n## Restructuring and reorganising data in R (long versus wide data)\n\n<iframe src=\"https://teesside.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=59c0876a-8047-401c-826a-aaec00cbb220&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&start=0&interactivity=all\" height=\"405\" width=\"100%\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n\n## Understanding objects in R\n\nIn R, an **object** is anything that is saved to memory. For example, we might do some analysis:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n    mean(happiness)\n```\n:::\n\n\n\n  \n     \nHowever, in the example above, the result would appear in the console but not be saved anywhere. To store the result for reuse later, we save it to an object: \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhappinessMean <- mean(happiness)\n```\n:::\n\n\n\n    \n\n\nIn the above code (reading left to right):\n\n- We name the object \"happinessMean\". This name can be anything we want.\n- The arrow means that the result of the code on the right will be saved to the object on the left.\n- The code on the right of the arrow calculates the mean of *happiness* data   \n    \nWhen this code is run, *happinessMean* will be stored in the environment window:\n\n![Result of a calculation in the environment](images/saveobject.png)\n\nTo recall an object from the environment, we can simply type its name. For example:\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n happinessMean\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 10.42048\n```\n:::\n:::\n\n \n    \n\n\n\n> Its important to note that anything can be stored as an object in R and recalled later. This includes, dataframes, the results of statistical calculations, plots etc.\n\n## Identify different data structures and variable types\n\n### Data structures\n\nThere are many different types of data that R can work with. The most common type of data for most people tends to be a **dataframe**. A **dataframe** is what you might consider a \"normal\" 2-dimensional dataset, with rows of data and columns of variables:\n\n![A dataframe example](images/dataframe.png)\n\nR can also use other data types.\n\nA vector is a one-dimensional set of values:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n# a vector example\n\nscores <- c(1,4,6,8,3,4,6,7)\n```\n:::\n\n\nA matrix is a multi-dimensional set of values. The below example is a 3-dimensional matrix, there are 2 groups of 2 rows and 3 columns:\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n, , 1\n\n     [,1] [,2] [,3]\n[1,]    1    3    5\n[2,]    2    4    6\n\n, , 2\n\n     [,1] [,2] [,3]\n[1,]    7    9   11\n[2,]    8   10   12\n```\n:::\n:::\n\n\n> We will primarily work with dataframes (and sometimes vectors), as this is how the data in psychology research is usually structured.\n\n### Variable types\n\nWith numerical data, there are 4 key data types:\n\n- Nominal (a category, group or factor)\n- Ordinal (a ranking)\n- Interval (scale data that can include negative values)\n- Ratio (scale data that cannot include negative values)\n\n![Numerical data types](images/dataTypes.png)\nR can use all of these variable types:\n\n\n- **Nominal** variables are called **factors**\n- **Ordinal** variables are called **ordered factors**\n- **Interval and ratio** variables are called **numeric** data and can sometimes be called integers (if they are only whole numbers) or doubles (if they all have decimal points)\n\nR can also use other data types such as text (**character**) data.\n\n### Convert variables from one type to another\n\nWhen we first import data into R, it might not recognise the data types correctly. For example, in the below data, we can see the **intervention** variable :\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| participant| intervention| happiness|\n|-----------:|------------:|---------:|\n|          19|            1|  8.472506|\n|          20|            1|  8.812926|\n|          15|            2|  9.117198|\n|           4|            2|  9.505235|\n|           2|            2|  9.660847|\n|           6|            2|  9.669608|\n|          12|            1|  9.764612|\n|           3|            1|  9.954183|\n|           1|            2| 10.090664|\n|          10|            1| 10.099453|\n\n</div>\n:::\n:::\n\nIn the **intervention** variable, the numbers 1 and 2 refer to different intervention groups. Therefore, the variable is a **factor** variable. To ensure that R understands this, we can resave the intervention variable as a factor using the *as.factor()* function:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhappinessSample$intervention <- as.factor(happinessSample$intervention)\n```\n:::\n\n\n\n## Working with dataframes\n\nDataframes are the more standard data format that were are used to (think of how a dataset looks in SPSS or Excel).\n\nIn a dataframe, variables are columns and each row usually reperesents one measurement or one participant.\n\n### View dataframe\n\nTo view a dataframe, we can click on it in the environment window and it will display:\n\n![Clicking on datasets in hte environment will open them up for viewing](images/environment.png)\n\n![Viewing a dataframe](images/dataframe.png)\n\n### Refer to variables (columns) in a dataframe\n\nColumns in a dataframe are accessed using the \"$\" sign. For example, to access the *happiness* column in the *happinessSample* dataframe, we would type:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhappinessSample$happiness\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] 10.090664  9.660847  9.954183  9.505235 11.725063  9.669608 10.588609\n [8] 10.459963 12.244699 10.099453 10.420561  9.764612 12.700549 11.592937\n[15]  9.117198 11.415905 11.018959 11.095057  8.472506  8.812926\n```\n:::\n:::\n\n\nAs we can see above, the result is then displayed.\n\n## Order, filter and group data\n\nIf you have the **tidyverse** package loaded, it is easy to organise and filter data.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\narrange(happinessSample, happiness)\narrange(happinessSample, desc(happiness)) # Arrange in descending order\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| participant|intervention | happiness|\n|-----------:|:------------|---------:|\n|          19|1            |  8.472506|\n|          20|1            |  8.812926|\n|          15|2            |  9.117198|\n|           4|2            |  9.505235|\n|           2|2            |  9.660847|\n|           6|2            |  9.669608|\n|          12|1            |  9.764612|\n|           3|1            |  9.954183|\n|           1|2            | 10.090664|\n|          10|1            | 10.099453|\n|          11|2            | 10.420561|\n|           8|1            | 10.459963|\n|           7|1            | 10.588609|\n|          17|1            | 11.018959|\n|          18|2            | 11.095057|\n|          16|2            | 11.415905|\n|          14|1            | 11.592937|\n|           5|1            | 11.725063|\n|           9|2            | 12.244699|\n|          13|2            | 12.700549|\n\n</div><div class=\"kable-table\">\n\n| participant|intervention | happiness|\n|-----------:|:------------|---------:|\n|          13|2            | 12.700549|\n|           9|2            | 12.244699|\n|           5|1            | 11.725063|\n|          14|1            | 11.592937|\n|          16|2            | 11.415905|\n|          18|2            | 11.095057|\n|          17|1            | 11.018959|\n|           7|1            | 10.588609|\n|           8|1            | 10.459963|\n|          11|2            | 10.420561|\n|          10|1            | 10.099453|\n|           1|2            | 10.090664|\n|           3|1            |  9.954183|\n|          12|1            |  9.764612|\n|           6|2            |  9.669608|\n|           2|2            |  9.660847|\n|           4|2            |  9.505235|\n|          15|2            |  9.117198|\n|          20|1            |  8.812926|\n|          19|1            |  8.472506|\n\n</div>\n:::\n:::\n\n\n- Show clients with a happiness score of less than 4\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfilter(happinessSample, happiness < 4)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| participant|intervention | happiness|\n|-----------:|:------------|---------:|\n\n</div>\n:::\n:::\n\n\n- Show Intervention group 2 with happiness scores above 7\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfilter(happinessSample, happiness > 7 & intervention == 2)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| participant|intervention | happiness|\n|-----------:|:------------|---------:|\n|           1|2            | 10.090664|\n|           2|2            |  9.660847|\n|           4|2            |  9.505235|\n|           6|2            |  9.669608|\n|           9|2            | 12.244699|\n|          11|2            | 10.420561|\n|          13|2            | 12.700549|\n|          15|2            |  9.117198|\n|          16|2            | 11.415905|\n|          18|2            | 11.095057|\n\n</div>\n:::\n:::\n\n\n- Group by intervention and show the mean happiness score\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhappinessSample %>% group_by(intervention) %>% summarise(mean = mean(happiness))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|intervention |     mean|\n|:------------|--------:|\n|1            | 10.24892|\n|2            | 10.59203|\n\n</div>\n:::\n:::\n\n\n\n## Create new variables from data\n\nTo create new variables from data, we can use the **mutate()** function.\n\nFor example, let's say we wanted to calculate the difference between each person's happiness score and the mean happiness score.\n\nWe could do the following:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nhappinessSample %>% mutate(difference = happiness - mean(happiness))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n| participant|intervention | happiness| difference|\n|-----------:|:------------|---------:|----------:|\n|           1|2            | 10.090664| -0.3298127|\n|           2|2            |  9.660847| -0.7596298|\n|           3|1            |  9.954183| -0.4662934|\n|           4|2            |  9.505235| -0.9152415|\n|           5|1            | 11.725063|  1.3045862|\n|           6|2            |  9.669608| -0.7508684|\n|           7|1            | 10.588609|  0.1681318|\n|           8|1            | 10.459963|  0.0394866|\n|           9|2            | 12.244699|  1.8242222|\n|          10|1            | 10.099453| -0.3210239|\n|          11|2            | 10.420561|  0.0000843|\n|          12|1            |  9.764612| -0.6558653|\n|          13|2            | 12.700549|  2.2800722|\n|          14|1            | 11.592937|  1.1724603|\n|          15|2            |  9.117198| -1.3032785|\n|          16|2            | 11.415905|  0.9954285|\n|          17|1            | 11.018959|  0.5984825|\n|          18|2            | 11.095057|  0.6745805|\n|          19|1            |  8.472506| -1.9479712|\n|          20|1            |  8.812926| -1.6075505|\n\n</div>\n:::\n:::\n",
    "supporting": [
      "workingWithData_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}