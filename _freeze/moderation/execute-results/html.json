{
  "hash": "960a7045e5e9e8a3459002be1e865c97",
  "result": {
    "markdown": "\n# Moderation analysis\n\n<iframe src=\"https://teesside.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=b944446e-b7fa-41ea-9d87-adaa008f4984&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&captions=false&interactivity=all\" height=\"405\" width=\"100%\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n\nAdditional moderation example:\n\n<iframe src=\"https://teesside.hosted.panopto.com/Panopto/Pages/Embed.aspx?id=56e7be24-4414-4a48-bb9f-adaa008f5a19&autoplay=false&offerviewer=true&showtitle=true&showbrand=false&captions=false&interactivity=all\" height=\"405\" width=\"100%\" style=\"border: 1px solid #464646;\" allowfullscreen allow=\"autoplay\"></iframe>\n\n## Overview\n\n- What is  moderation?\n- Moderation analysis in more detail\n- Grand Mean Centering\n- Checking Assumptions\n- Interpreting Moderation\n- Bootstrapping Moderation\n\n\n## What is moderation?\n\n\nThere is a direct relationship between X and Y but it is affected by a moderator (M)\n\n![A moderated relationship](images/moderation_model1.png)\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nIn the above model, we theorise that Time in counselling predicts General Wellbeing but the strength of the relationship is affected by the level of Rapport with counsellor\n\n\n\n## What packages do we need?\n\n- **gvlma** (for checking assumptions)\n- **interactions** (for generating interaction plot)\n- **Rockchalk** (for testing simple slopes)\n- **car** (includes a **Boot()** function to bootstrap regression models )\n\n\n## What is moderation?\n\n\n- The relationship between a predictor (X) and outcome (Y) is affected by another variable (M)\n- This is referred to as an interaction (similar to interaction in standard regression)\n- A moderator can effect the direction and/or strength of a relationship between X and Y\n\n\n![A moderated relationship](images/moderation_model1.png)\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nHere we might find that the relationship between Time in counselling and General Wellbeing is strong for those who have a strong rapport with their counselling psychologist and weak for those who do not have good rapport with their counselling psychologist.\n\n\n\n- Very similar to multiple regression\n    \n    lm(Y ~ X + M + X*M)\n\n- Moderation analysis includes X, Z and the interaction between X and Z\n\n- If we find a moderation effect it becomes the focus of our analysis (the independent role of X and Z becomes less important)\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](moderation_files/figure-html/unnamed-chunk-3-1.png){fig-align='center' width=60%}\n:::\n:::\n\n\n\nIn the plot above:\n\n- The blue line is the \"standard\" regression line\n- The black line is when the moderator is \"low\" (-1sd)\n- The dotted line is when the moderator is \"high\" (+1sd)\n\n\n## Moderation: step-by-step\n\n\n\n### Step 1: Grand Mean Centering\n\n\n- Regression coefficients (b values) are based on predicting Y when X = 0\n- Not all measures actually have a zero value\n- To make results easier to interpret, we can centre our data around the grand mean of the data (making the mean 0)\n  - The mean of the full sample is subtracted from the value\n- This is similar to z-score (i.e. a standardised score)\n\nTo do this in R, we can use the **scale()** function:\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n    timeInCounselling_centred    <- scale(timeInCounselling, center=TRUE, scale=FALSE) #Centering X; \n    rapportLevel_centred    <- scale(rapportLevel,  center=TRUE, scale=FALSE) #Centering M;\n```\n:::\n\n\n\n    \nWe then use the centred data in our analysis\n\nWe can see that the difference between the original data is the mean of the data.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n  timeInCounselling_centred    <- scale(timeInCounselling, center=TRUE, scale=FALSE) #Centering X; \n  \n  timeInCounselling\n \n  head(timeInCounselling_centred)\n  \n   mean(timeInCounselling)\n  timeInCounselling[1]-timeInCounselling_centred[1]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1]  3.7580974  5.0792900 12.2348333  6.2820336  6.5171509 12.8602599\n  [7]  7.8436648  0.9397551  3.2525886  4.2173521 10.8963272  7.4392553\n [13]  7.6030858  6.4427309  3.7766355 13.1476525  7.9914019  1.8664686\n [19]  8.8054236  4.1088344  1.7287052  5.1281003  1.8959822  3.0844351\n [25]  3.4998429  0.7467732  9.3511482  6.6134925  1.4474523 11.0152597\n [31]  7.7058569  4.8197141  9.5805026  9.5125340  9.2863243  8.7545610\n [37]  8.2156706  5.7523532  4.7761493  4.4781160  3.2211721  5.1683309\n [43]  0.9384146 14.6758239 10.8318480  1.5075657  4.3884607  4.1333786\n [49]  9.1198605  5.6665237  7.0132741  5.8858130  5.8285182 11.4744091\n [55]  5.0969161 12.0658824  0.1950112  8.3384550  6.4954170  6.8637663\n [61]  7.5185579  3.9907062  4.6671705  1.9256985  1.7128351  7.2141146\n [67]  7.7928391  6.2120169  9.6890699 14.2003387  4.0358753  3.2366755\n [73] 10.0229541  3.1631969  3.2479655 10.1022855  4.8609080  1.1171292\n [79]  6.7252139  5.4444346  6.0230567  7.5411216  4.5173599  8.5775062\n [85]  5.1180538  7.3271279 10.3873561  7.7407260  4.6962737 10.5952305\n [91]  9.9740154  8.1935878  6.9549269  3.4883757 11.4426098  3.5989617\n [97] 14.7493320 12.1304425  5.0571986  1.8943164\n            [,1]\n[1,] -2.72442479\n[2,] -1.40323216\n[3,]  5.75231105\n[4,] -0.20048864\n[5,]  0.03462873\n[6,]  6.37773774\n[1] 6.482522\n[1] 6.482522\n```\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n#Centering Data\nModdata$timeInCounselling_centred    <- c(scale(timeInCounselling, center=TRUE, scale=FALSE)) \n\n#Centering IV; \nModdata$rapportLevel_centred    <- c(scale(rapportLevel,  center=TRUE, scale=FALSE)) #Centering moderator; \n\n#Moderation \"By Hand\" with centred data\nlibrary(gvlma)\nfitMod <- lm(generalWellbeing ~ timeInCounselling_centred *rapportLevel_centred  , data = Moddata) #Model interacts IV & moderator\n\nlibrary(interactions)\n ip <- interact_plot(fitMod, pred = timeInCounselling_centred, modx = rapportLevel_centred)\n ip\n```\n\n::: {.cell-output-display}\n![](moderation_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n#### Do I need to mean centre my data?\n\nIt is worth noting:\n\n- It does not change the results of your interaction (coefficient, standard error or significance tests).\n- It will change the results of the direct effects (the individual predictors in your model).\n- It is a step that tries to ensure that the coefficients of the predictor and moderator are meaningful in relation to each other.\n- In some cases, it might not be necessary to mean centre at all. However, there is no harm in doing so, and it could potentially be helpful.\n\nHayes (2013) discusses mean centering, pp. 282-290. \n\nrapportLevel_centredClelland, G. H., Irwin, J. R., Disatnik, D., & Sivan, L. (2017). Multicollinearity is a red herring in the search for moderator variables: A guide to interpreting moderated multiple regression models and a critique of Iacobucci, Schneider, Popovich, and Bakamitsos (2016). Behavior research methods, 49(1), 394-402.\n\n### Step 2: Check assumptions\n\n\nWe can use the gvlma function to check regression assumptions \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(gvlma)\ngvlma(fitMod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = generalWellbeing ~ timeInCounselling_centred * rapportLevel_centred, \n    data = Moddata)\n\nCoefficients:\n                                   (Intercept)  \n                                       21.1851  \n                     timeInCounselling_centred  \n                                        0.8971  \n                          rapportLevel_centred  \n                                        0.5842  \ntimeInCounselling_centred:rapportLevel_centred  \n                                        0.1495  \n\n\nASSESSMENT OF THE LINEAR MODEL ASSUMPTIONS\nUSING THE GLOBAL TEST ON 4 DEGREES-OF-FREEDOM:\nLevel of Significance =  0.05 \n\nCall:\n gvlma(x = fitMod) \n\n                    Value p-value                   Decision\nGlobal Stat        9.6949 0.04589 Assumptions NOT satisfied!\nSkewness           7.7571 0.00535 Assumptions NOT satisfied!\nKurtosis           1.2182 0.26972    Assumptions acceptable.\nLink Function      0.5287 0.46716    Assumptions acceptable.\nHeteroscedasticity 0.1910 0.66207    Assumptions acceptable.\n```\n:::\n:::\n\n\nThe \"global stat\" is an attempt to check multiple assumptions of linear model: Pena, E. A., & Slate, E. H. (2006). Global validation of linear model assumptions. Journal of the American Statistical Association, 101(473), 341-354.\n\nSince one of the underlying assumptions is violated, the overall stat is also not acceptable.\n\nThe data looks skewed, we should transform it or perhaps use bootstrapping\n\n\n\n### Step 3: Moderation Analysis\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nfitMod <- lm(generalWellbeing ~ timeInCounselling_centred *rapportLevel_centred  , data = Moddata) #Model interacts IV & moderator\n #Model interacts IV & moderator\nsummary(fitMod)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = generalWellbeing ~ timeInCounselling_centred * rapportLevel_centred, \n    data = Moddata)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-18.121  -8.938  -0.670   5.840  37.396 \n\nCoefficients:\n                                               Estimate Std. Error t value\n(Intercept)                                    21.18508    1.14115  18.565\ntimeInCounselling_centred                       0.89707    0.33927   2.644\nrapportLevel_centred                            0.58416    0.15117   3.864\ntimeInCounselling_centred:rapportLevel_centred  0.14948    0.04022   3.716\n                                               Pr(>|t|)    \n(Intercept)                                     < 2e-16 ***\ntimeInCounselling_centred                      0.009569 ** \nrapportLevel_centred                           0.000203 ***\ntimeInCounselling_centred:rapportLevel_centred 0.000340 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 11.33 on 96 degrees of freedom\nMultiple R-squared:  0.2737,\tAdjusted R-squared:  0.251 \nF-statistic: 12.06 on 3 and 96 DF,  p-value: 9.12e-07\n```\n:::\n:::\n\n\nThe results above show that there is a moderated effect\n\n\n\n#### Visualising the moderation effect\n\n\nWe use an approach called **simple slopes** to visualise the moderation effect\n\n\n    interact_plot(fitMod, pred = timeInCounselling_centred, modx = rapportLevel_centred)\n    \n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](moderation_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\nThe **rockchalk** package includes useful functions for visualising simple slopes\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(rockchalk)\n\nfitMod <- lm(generalWellbeing ~ timeInCounselling *rapportLevel  , data = Moddata)\nsummary(fitMod)\nslopes <- plotSlopes(fitMod, modx = \"rapportLevel\", plotx = \"timeInCounselling\")\n```\n\n::: {.cell-output-display}\n![](moderation_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=100%}\n:::\n\n```{.r .cell-code}\ntestSlopes <- testSlopes(slopes)\nplot(testSlopes)\n```\n\n::: {.cell-output-display}\n![](moderation_files/figure-html/unnamed-chunk-10-2.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\nCall:\nlm(formula = generalWellbeing ~ timeInCounselling * rapportLevel, \n    data = Moddata)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-18.121  -8.938  -0.670   5.840  37.396 \n\nCoefficients:\n                               Estimate Std. Error t value Pr(>|t|)    \n(Intercept)                    17.28006    3.17944   5.435 4.15e-07 ***\ntimeInCounselling               0.15510    0.42033   0.369  0.71296    \nrapportLevel                   -0.38484    0.29916  -1.286  0.20140    \ntimeInCounselling:rapportLevel  0.14948    0.04022   3.716  0.00034 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 11.33 on 96 degrees of freedom\nMultiple R-squared:  0.2737,\tAdjusted R-squared:  0.251 \nF-statistic: 12.06 on 3 and 96 DF,  p-value: 9.12e-07\n\nValues of rapportLevel OUTSIDE this interval:\n        lo         hi \n-11.580166   3.634439 \ncause the slope of (b1 + b2*rapportLevel)timeInCounselling to be statistically significant\n```\n:::\n:::\n\n\n\n### Step 4: Bootstrapping\n\n\nThe **car** package includes a function to bootstrap regression\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(car)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nLoading required package: carData\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'carData' was built under R version 4.2.3\n```\n:::\n\n```{.r .cell-code}\nbootstrapModel <- Boot(fitMod, R=999)\n\nconfint(fitMod)\nconfint(bootstrapModel)\nsummary(bootstrapModel)\nhist(bootstrapModel)\n```\n\n::: {.cell-output-display}\n![](moderation_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=100%}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n                                     2.5 %     97.5 %\n(Intercept)                    10.96891826 23.5912086\ntimeInCounselling              -0.67926290  0.9894532\nrapportLevel                   -0.97866229  0.2089882\ntimeInCounselling:rapportLevel  0.06963667  0.2293205\nBootstrap bca confidence intervals\n\n                                     2.5 %     97.5 %\n(Intercept)                    11.57230420 23.7222700\ntimeInCounselling              -0.61780918  1.0397199\nrapportLevel                   -0.90786799  0.2558502\ntimeInCounselling:rapportLevel  0.05806412  0.2146814\n```\n:::\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|                               |   R|   original|   bootBias|    bootSE|    bootMed|\n|:------------------------------|---:|----------:|----------:|---------:|----------:|\n|(Intercept)                    | 999| 17.2800634| -0.1366710| 3.1653009| 17.0543132|\n|timeInCounselling              | 999|  0.1550951|  0.0163712| 0.3995498|  0.1592933|\n|rapportLevel                   | 999| -0.3848371|  0.0071663| 0.2940609| -0.3821849|\n|timeInCounselling:rapportLevel | 999|  0.1494786| -0.0005284| 0.0385163|  0.1497413|\n\n</div>\n:::\n:::\n",
    "supporting": [
      "moderation_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}